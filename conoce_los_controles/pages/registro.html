<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>‚úÖ Registro de uso ¬∑ Controles VR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../assets/css/styles.css" />
</head>
<body>
<header class="topbar">
  <div class="topbar-left">
    <button class="btn-icon" onclick="location.href='../index.html'">üè†</button>
    <span class="brand">
      <strong>Registro de uso</strong><br/>
      <small>Controles Oculus / Meta Quest ¬∑ Sala SEM</small>
    </span>
  </div>
</header>

<main id="main-content">
  <section class="cards-grid">
    <article class="card">
      <h2>‚úÖ Registro para evidencias</h2>
      <p>Bel√©n u otro docente puede anotar aqu√≠ c√≥mo le fue a cada estudiante con los controles.</p>
      <form id="reg-form">
        <label>Nombre estudiante<br/>
          <input type="text" id="nombre" required />
        </label><br/><br/>
        <label>Curso<br/>
          <input type="text" id="curso" placeholder="Ej: 6¬∞B" />
        </label><br/><br/>
        <label>Fecha<br/>
          <input type="date" id="fecha" />
        </label><br/><br/>
        <label>Nivel de manejo de controles<br/>
          <select id="manejo">
            <option value="autonomo">Manipula controles de forma aut√≥noma</option>
            <option value="apoyo_parcial">Necesita apoyo parcial</option>
            <option value="apoyo_total">Necesita apoyo total</option>
          </select>
        </label><br/><br/>
        <label>Reacciones y observaciones<br/>
          <textarea id="obs" rows="3"></textarea>
        </label><br/><br/>
        <button type="button" class="btn-main" id="btn-add">‚ûï Agregar fila</button>
        <button type="button" class="btn-ghost" id="btn-download">üíæ Descargar CSV</button>
      </form>
    </article>
    <article class="card">
      <h2>üìä Tabla de registros</h2>
      <table id="reg-table" style="width:100%;font-size:0.78rem;border-collapse:collapse;">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Curso</th>
            <th>Fecha</th>
            <th>Manejo controles</th>
            <th>Observaciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </article>
  </section>
</main>

<script>
  const rows = [];
  const addBtn = document.getElementById('btn-add');
  const downloadBtn = document.getElementById('btn-download');
  const tbody = document.querySelector('#reg-table tbody');

  function addRow() {
    const nombre = document.getElementById('nombre').value.trim();
    const curso = document.getElementById('curso').value.trim();
    const fecha = document.getElementById('fecha').value;
    const manejo = document.getElementById('manejo').value;
    const obs = document.getElementById('obs').value.trim().replace(/(\r|\n)+/g, ' ');
    if (!nombre) {
      alert('Escribe el nombre del estudiante.');
      return;
    }
    const row = { nombre, curso, fecha, manejo, obs };
    rows.push(row);
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${nombre}</td><td>${curso}</td><td>${fecha}</td><td>${manejo}</td><td>${obs}</td>`;
    tbody.appendChild(tr);
    document.getElementById('reg-form').reset();
  }

  function downloadCSV() {
    if (!rows.length) {
      alert('No hay filas para descargar.');
      return;
    }
    const header = ['Nombre','Curso','Fecha','Manejo_controles','Observaciones'];
    const lines = [header.join(',')];
    rows.forEach(r => {
      const line = [
        r.nombre.replace(/,/g,';'),
        r.curso.replace(/,/g,';'),
        r.fecha,
        r.manejo.replace(/,/g,';'),
        r.obs.replace(/,/g,';')
      ].join(',');
      lines.push(line);
    });
    const blob = new Blob([lines.join('\n')], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    const today = new Date().toISOString().slice(0,10).replace(/-/g,'');
    a.href = url;
    a.download = `registro_controles_sem_${today}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  if (addBtn) addBtn.addEventListener('click', addRow);
  if (downloadBtn) downloadBtn.addEventListener('click', downloadCSV);
</script>
<footer class="footer">
  <span>Centro de Recursos VR Inclusivos ¬∑ Neotech EduLab</span>
  <span class="footer-logo"><img src="../assets/img/logo_NEOTECH-EDULAB.png" alt="Neotech EduLab" /></span>
</footer>
</body>
</html>
